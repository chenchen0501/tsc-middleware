# JJG 批量打印脚本使用说明

## 📄 文件说明

- `priint_1296_jjg.py` - 批量打印 1296 个 JJG 标签的主脚本
- `test_cooling.py` - 冷却机制模拟测试脚本

## 🚀 快速开始

### 1. 确保打印服务运行

```bash
# 在项目根目录启动 FastAPI 服务
cd /Users/chenchen/Documents/cc-code/tsc-api
python main.py
```

### 2. 运行打印脚本

```bash
# 在 scripts 目录运行
cd scripts
python priint_1296_jjg.py
```

### 3. 测试模式（仅查看标签，不打印）

```bash
python priint_1296_jjg.py --test
```

## 🌡️ 冷却机制

为了保护热敏打印机打印头，脚本内置了智能冷却机制：

### 配置参数

```python
COOLING_INTERVAL = 50  # 每打印50张，暂停冷却
COOLING_TIME = 45      # 冷却45秒（30-60秒之间）
```

### 冷却策略

**针对 1296 个标签（216 张纸）的打印任务：**

| 打印进度      | 冷却时机      | 说明        |
| ------------- | ------------- | ----------- |
| 第 1-50 张    | 正常打印      | 0.5 秒延迟  |
| 第 50 张后    | 🌡️ 冷却 45 秒 | 第 1 次冷却 |
| 第 51-100 张  | 正常打印      | 0.5 秒延迟  |
| 第 100 张后   | 🌡️ 冷却 45 秒 | 第 2 次冷却 |
| 第 101-150 张 | 正常打印      | 0.5 秒延迟  |
| 第 150 张后   | 🌡️ 冷却 45 秒 | 第 3 次冷却 |
| 第 151-200 张 | 正常打印      | 0.5 秒延迟  |
| 第 200 张后   | 🌡️ 冷却 45 秒 | 第 4 次冷却 |
| 第 201-216 张 | 正常打印      | 0.5 秒延迟  |

**总计：4 次冷却，共 180 秒（3 分钟）**

### ⏱️ 预计时间

```
打印时间:   216张 × 3秒    = 648秒   (10.8分钟)
延迟时间:   215次 × 0.5秒  = 108秒   (1.8分钟)
冷却时间:   4次 × 45秒     = 180秒   (3.0分钟)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
预计总时间:                   936秒   (15.6分钟)
```

## 📋 标签格式

```
JJG + 日期(8位) + 序号(5位)
```

**示例：**

- 第一个: `JJG2025110600001`
- 第二个: `JJG2025110600002`
- 最后一个: `JJG2025110601296`

## 🔧 修改参数

如需修改固定参数，编辑 `priint_1296_jjg.py` 中的 `generate_jjg_labels()` 函数：

```python
def generate_jjg_labels() -> list[str]:
    # 固定配置
    PREFIX = "JJG"          # 修改前缀
    DATE = "20251106"       # 修改日期（YYYYMMDD格式）
    START = 1               # 修改起始序号
    END = 1296              # 修改结束序号
    SERIAL_LENGTH = 5       # 修改序号位数
```

如需修改冷却策略，编辑 `print_batch()` 方法：

```python
# 冷却机制配置
COOLING_INTERVAL = 50  # 每打印N张，暂停冷却
COOLING_TIME = 45      # 冷却N秒
```

## 📊 输出示例

```
============================================================
📋 批量打印任务
============================================================
标签总数: 1296 个
每张纸: 6 个格子
打印张数: 216 张
服务地址: http://172.16.10.28:8000
冷却策略: 每 50 张暂停 45 秒
预计冷却: 4 次（约 180 秒）
============================================================

[批次 1/216] 打印标签 1-6 ...
  ✅ 成功: 打印成功
[批次 2/216] 打印标签 7-12 ...
  ✅ 成功: 打印成功
...
[批次 50/216] 打印标签 295-300 ...
  ✅ 成功: 打印成功

============================================================
🌡️  已连续打印 50 张，让打印机冷却...
⏸️  暂停 45 秒（第 1 次冷却）
============================================================
   ⏳ 剩余 45 秒...
   ⏳ 剩余 40 秒...
   ...
   ✅ 冷却完成，继续打印...
============================================================

...继续打印...

============================================================
📊 打印统计
============================================================
成功: 216/216 批次 (1296 个标签)
失败: 0/216 批次
冷却: 4 次（共 180 秒）
============================================================

============================================================
✅ 打印任务完成
============================================================
总耗时: 936.50 秒
成功率: 216/216 (100.0%)
============================================================
```

## ⚠️ 注意事项

1. **首次使用建议**

   - 先运行 `--test` 模式查看标签生成是否正确
   - 第一次打印建议只打印 50 张测试效果

2. **打印机状态监控**

   - 注意观察打印质量
   - 如果发现打印头明显发热，可以增加冷却时间
   - 如果出现打印质量下降，立即停止并检查打印机

3. **网络连接**

   - 确保打印服务和打印机连接正常
   - 打印机 IP: `172.16.10.28:8000`
   - 可通过 `/health` 接口检查服务状态

4. **错误处理**
   - 如果某个批次失败，脚本会继续打印后续批次
   - 最后会统计失败的批次和原因
   - 可以根据失败信息重新打印失败的标签

## 🧪 测试冷却机制

运行模拟测试查看冷却时机：

```bash
python test_cooling.py
```

## 💡 优化建议

如果打印过程中遇到问题，可以调整：

1. **降低速度**：增加 `delay` 参数（如改为 1.0 秒）
2. **增加冷却频率**：降低 `COOLING_INTERVAL`（如改为 30 张）
3. **延长冷却时间**：增加 `COOLING_TIME`（如改为 60 秒）
4. **分批打印**：每次打印 50-100 张，手动检查后继续

## 📞 技术支持

如遇问题，请检查：

- FastAPI 服务是否正常运行
- 打印机 USB 连接是否正常
- 打印机是否有足够的耗材
- 查看日志文件获取详细错误信息
